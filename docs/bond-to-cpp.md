How to generate bondlite serialization/deserialization code
-----------------------------------------------------------

1. Download OneCollector Server bond definition - CommonSchemaEvent.bond from server repo:

https://msazure.visualstudio.com/OneDsCollector/_git/Collector?path=%2FServices%2FModels%2FCommonSchema%2FBond%2FCommonSchemaEvent.bond&version=GBmaster

NOTE: only Microsoft employees are authorized to access this resource.

2. Rename CommonSchemaEvent.bond to CsProtocol.bond.

3. Remove comments, Bond metadata, BOM-markers, normalize tabs and linebreaks.

4. Comment out recursive Ingest.processedIngest field.

5. Change namespace to CsProtocol.

6. Change CommonSchemaEvent struct name to CsEvent.

7. Replace all 'nullable' with 'vector'.

8. Remove default 'nothing' for strings to avoid maybe<>.

9. Remove bonded<>.

10. Store clean bond definition file in lib\bond\CsProtocol.bond and perform visual inspection of diff old vs. new schema.

11. Run tools\gen-bond.cmd to get the code generated in lib\bond\generated, perform visual inspection of diff old vs. new schema.

12. Make sure that the resulting code compiles, run tests, visually inspect events ingested on portal and/or xpert.


Why so many manual steps? Schema does not change often. Pay due diligence to verify the new schema & code generated.
Ultimately the code generator is a helper tool, you must clearly understand the purpose of code generated by the tool.
